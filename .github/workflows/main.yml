name: Deploy Django
# This workflow is triggered on pushes to the repository.
on: [ push ]

jobs:
  build:
    # Job name is Greeting
    name: Deploy
    # This job runs on Linux
    runs-on: ubuntu-latest
    steps:
      # Connect with SSH
      - name: Test
        env:
          TEST: ${{ secrets.TEST }}
        run: echo env.TEST
      - name: Set-up
        env:
          SSH_KEY: ${{ secrets.SSH_KEY }}
        run: echo env.SSH_KEY > tmp.txt
        # This step is necessary to avoid the error when using an unprotected private key file
      - name: Chmod
        run: chmod 600 tmp.txt
      - name: Execute
        env:
          USERNAME: ${{ secrets.USERNAME }}
          HOST: ${{ secrets.HOST}}
        run: ssh -i tmp.txt -o StrictHostKeyChecking=no env.USERNAME@env.HOST 'cd mkofoed/ && make'
      - name: Clean-up
        run: rm tmp.txt